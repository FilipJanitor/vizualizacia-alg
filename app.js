function Delta(a,b,c,d,e){this._originalState=a,this._reading=b,this._newState=c,this._printing=d,this._moving=e,this.getOriginalState=function(){return this._originalState},this.getReading=function(){return this._reading},this.getNewState=function(){return this._newState},this.getPrinting=function(){return this._printing},this.getMoving=function(){return this._moving}}function StorageNode(a,b){this.upperLevel=a,this.lowerLevel=b,this.isEmpty=function(){return" "===this.upperLevel&&" "===this.lowerLevel?2:" "===this.upperLevel||" "===this.lowerLevel?1:0}}function NegativeArray(){this.__positive=[],this.__negative=[],this.add=function(a,b){"number"==typeof a&&Math.round(a)===a?a>=0?this.__positive[a]=b:this.__negative[-a-1]=b:console.error("indexing to array must be done with integer")},this.get=function(a){return"number"==typeof a&&Math.round(a)===a?a>=0?this.__positive[a]:this.__negative[-a-1]:(console.error("indexing to array must be done with integer - returning null"),null)},this.positiveLength=function(){return this.__positive.length},this.negativeLength=function(){return this.__negative.length+1},this.getLength=function(){return this.__positive.length+this.__negative.length+1}}function MachineView(){this._beginning=0,this._end=17,this._head=8,this._originalViewBeginning=0,this._originalViewEnd=17,this.changeInterval=function(a,b){return a+17!=b?!1:(this._beginning=a,void(this._end=b))},this.reInitialise=function(a,b,c){return a+17!=b||a+8!=c?!1:(this._beginning=a,this._end=b,void(this._head=c))},this.getCurrentHeadPosition=function(){return this._head},this.getViewHeadPosition=function(){return this._head-(this._beginning+8)},this.moveRight=function(){this._beginning++,this._end++,this._head++},this.moveLeft=function(){this._beginning--,this._end--,this._head--},this.getBeginning=function(){return this._beginning},this.getEnd=function(){return this._end},this.moveView=function(a){this._beginning+=a,this._end+=a},this.reInitialiseOriginal=function(){this._beginning=this._head-8,this._end=this._beginning+17}}function StepInformationContainer(a,b,c,d){this._stepState=a,this._indexOfOriginalTrack=b,this._iBlockNumber=c,this._overwriteSymbol=d,this.getStepState=function(){return this._stepState},this.getIndexOfOriginalTrack=function(){return this._indexOfOriginalTrack},this.getIBlockNumber=function(){return this._iBlockNumber},this.getOverwriteSymbol=function(){return this._overwriteSymbol},this.getStepState=function(){return this._stepState}}function PrintingSquare(a,b,c){this._row=b,this._index=a,this._simulatedTrack=c,this.getRow=function(){return this._row},this.getIndex=function(){return this._index},this.getSimulatedTrack=function(){return this._simulatedTrack}}function CircularStack(){var a=[],b=0,c=0,d=100;this.push=function(e){a[c]=e,c=(c+1)%d,c==b&&(b=(b+1)%d)},this.pop=function(){if(b==c)return void 0;c-=1,0>c&&(c+=d);var e=a[c];return e}}var app=angular.module("App",[]);app.service("simulationService",function(){var a={},b={},c={},d={},e={},f={},g={};this.simulationStorageTapeArray=g,this.kNumber=a,this.kSourceTapes=b,this.deltaFunction=c,this.mode=d,this.isActive=e,this.simulatingArray=f}),app.controller("mainController",["$scope","simulationService","$window","$log",function(a,b,c,d){a.stateEnum={BEGINNING:1,MODE_1_CHOOSE_INPUT:2,MODE_2_CHOOSE_INPUT:3,MODE_2_CHOOSE_DELTA:4,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},a.kNumber={value:void 0},a.kSourceTapes=[],a.currentState=a.stateEnum.BEGINNING,a.deltaFunction=[],a.deltaArrayTemp=[],a.masterFormCommas="",a.simulationStorageTapeArray=[],a.myMinLength=0,a.myMaxLength=0,a.isDeterministic={value:!0,errLog:""},a.deltaTemp={value:""},a.resetDelta=function(){a.deltaTemp.value=angular.copy(a.masterFormCommas)},a.restartSimulation=function(){c.location.reload()},a.setMode=function(b){for(var c=0;c<a.kNumber.value;c++)a.kSourceTapes.push("");if(1==b)a.currentState=a.stateEnum.MODE_1_CHOOSE_INPUT;else{a.currentState=a.stateEnum.MODE_2_CHOOSE_INPUT;for(var c=0;c<3*a.kNumber.value+1;c++)a.masterFormCommas+=",";a.myMinLength=3*a.kNumber.value+2,a.myMaxLength=4*a.kNumber.value+2}},a.prepareSimulatingArray=function(){for(var b=[],c=0;c<a.kNumber.value;c++)b.push({movement:"0"});return b},a.changeStateToChooseDelta=function(){a.currentState=a.stateEnum.MODE_2_CHOOSE_DELTA,a.resetDelta()},a.startSimulation=function(c){if(a.simulatingArray=a.prepareSimulatingArray(),a.kSourceTapes[0].length<9){for(var d="",e=9-a.kSourceTapes[0].length;e>0;e--)d+="\xd7";a.kSourceTapes[0]=a.kSourceTapes[0]+d}a.kSourceTapes[0]="\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7"+a.kSourceTapes[0];for(var f=1;f<a.kNumber.value;f++)a.kSourceTapes[f]="\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7\xd7"+a.kSourceTapes[f];for(var g=Math.pow(2,Math.floor(Math.log(a.kSourceTapes[0].length-8-1)/Math.LN2)+1)-1,h=Math.max(g,8),f=0;f<a.kNumber.value;f++)if(a.simulationStorageTapeArray.push(new NegativeArray),0===f){for(var i=0;i<a.kSourceTapes[0].length-8;i++)a.simulationStorageTapeArray[0].add(i,new StorageNode(" ",a.kSourceTapes[0].charAt(i+8)));for(var j=a.kSourceTapes[0].length-8;h>=j;j++)a.simulationStorageTapeArray[0].add(j,new StorageNode(" ","\xd7"));for(var k=1;h>=k;k++)a.simulationStorageTapeArray[0].add(-k,new StorageNode(" ","\xd7"))}else for(var i=-h;h>=i;i++)a.simulationStorageTapeArray[f].add(i,new StorageNode(" ","\xd7"));b.kNumber.value=a.kNumber.value,b.kSourceTapes.value=a.kSourceTapes,b.simulatingArray.value=a.simulatingArray,b.simulationStorageTapeArray.value=a.simulationStorageTapeArray,1==c?(a.currentState=a.stateEnum.MODE_1_SIMULATE,b.mode.value=a.stateEnum.MODE_1_SIMULATE):(a.currentState=a.stateEnum.MODE_2_SIMULATE,b.deltaFunction.value=a.deltaFunction,b.mode.value=a.stateEnum.MODE_2_SIMULATE),b.isActive.value=!0},a.addNewDeltaTemp=function(){a.deltaArrayTemp.push({value:angular.copy(a.masterFormCommas),invalid:!1,err:""})},a.removeDeltaTemp=function(b){a.deltaArrayTemp.splice(b,1)},a.validateDeltaStartSimulation=function(){a.deltaFunction.length=0;for(var b,c=!0,d=!0,e=0;e<a.deltaArrayTemp.length;e++)b=a.registerDelta(a.deltaArrayTemp[e]),b!==!0?(c=!1,a.deltaArrayTemp[e].invalid=!0,a.deltaArrayTemp[e].err=b):(a.deltaArrayTemp[e].invalid=!1,a.deltaArrayTemp[e].err="");for(var f="Chyba nedeterminizmu pri riadkoch: ",e=0;e<a.deltaFunction.length;e++)for(var g=e+1;g<a.deltaFunction.length;g++)a.deltaFunction[e].getOriginalState()==a.deltaFunction[g].getOriginalState()&&a.deltaFunction[e].getReading().toString()===a.deltaFunction[g].getReading().toString()&&(c=!1,d=!1,f+=" "+(e+1)+" a "+(g+1)+";");c?(a.isDeterministic.value=!0,a.isDeterministic.errLog="",a.startSimulation(3)):d||(a.isDeterministic.value=!1,a.isDeterministic.errLog=f)},a.registerDelta=function(b){var e,c=b.value.split(","),d="",f={value:!1};c.length!=3*a.kNumber.value+2&&(f.value=!0,d+="Zl\xe1 d\u013a\u017eka vstupu. "),c[0].length>15&&(f.value=!0,d+="Stav mus\xed ma\u0165 najviac 15 znakov. ");for(var g=c[0],h=[],i=1;i<1+a.kNumber.value;i++)1!=c[i].length?(f.value=!0,d+="Hlava m\xf4\u017ee \u010d\xedta\u0165 pr\xe1ve jeden znak. Probl\xe9m je v \u010d\xedtan\xed "+(i-1+1)+" p\xe1sky. "):h.push(c[i]);1!=c[1+a.kNumber.value].length?(f.value=!0,d+="Nov\xfd stav m\xf4\u017ee ma\u0165 najviac 15 znakov. "):e=c[1+a.kNumber.value];for(var j=[],i=a.kNumber.value+2;i<2+2*a.kNumber.value;i++)1!=c[i].length?(f.value=!0,d+="Hlava m\xf4\u017ee p\xedsa\u0165 pr\xe1ve jeden znak. Probl\xe9m je v prepisovan\xed "+(i-(a.kNumber.value+2)+1)+" p\xe1sky. "):j.push(c[i]);for(var k=[],i=2+2*a.kNumber.value;i<2+3*a.kNumber.value;i++)"0"==c[i]||"-1"==c[i]||"1"==c[i]?k.push(c[i]):(f.value=!0,d+="Pohyb hlavy m\xf4\u017ee by\u0165 ozna\u010dovan\xfd len -1 0 1. Probl\xe9m je s hlavou "+(i-(2+2*a.kNumber.value)+1)+". ");return 1==f.value?d:(f.value=!1,a.deltaFunction.push(new Delta(g,h,e,j,k)),!0)}}]),app.controller("simulationController",["$scope","$window","$log","simulationService",function(a,b,c,d){a.stateEnum={IDLE:1,IN_PROGRESS:2,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},a.simulationStateEnum={OVERWRITING_HOME_COLUMN:1,EMPTY_BLOCK_REARRANGE_SYMBOLS:2,EMPTY_BLOCK_FROM_COPY_TAPE:3,HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:4,HALF_EMPTY_BLOCK_FROM_COPY_TAPE:5,FULL_BLOCK_ON_OPPOSITE_SIDE:6,FULL_BLOCK_FROM_COPY_TAPE:7,HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:8,HALF_FULL_BLOCK_FROM_COPY_TAPE:9,VISUALIZE_OVERWRITING_HOME_COLUMN:11,VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS:12,VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE:13,VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:14,VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE:15,VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE:16,VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE:17,VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:18,VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE:19},a.visualizationStateEnum={NO_VISUALIZATION:0,MODE_1_VISUALIZE:1,MODE_2_VISUALIZE:2},a.CONSTANT_VIEW_ARRAY=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],a.CONSTANT_X_VIEW_ARRAY=[60,100,140,180,220,260,300,340,380,420,460,500,540,580,620,660,700],a.reducedMachineCopyTapeOffset={value:0},a.neededHeightOfSvg={value:0},a.storageTapeOffset={value:0},a.originalMachineViews=[],a.reducedMachineStorageTapeViews=new MachineView,a.reducedMachineCopyTapeViews=new MachineView,a.kSourceTapes=d.kSourceTapes,a.kNumber=d.kNumber,a.mainMode=d.mode,a.deltaFunction=d.deltaFunction,a.activeSimulation=d.isActive,a.simulatingArray=d.simulatingArray,a.simulationStorageTapeArray=d.simulationStorageTapeArray,a.reducedMachineCopyTape="                 ",a.reducedMachineCopyTapeArray=[],a.originalMachineState="0",a.simulationMode=a.stateEnum.IDLE,a.currentSimulationStateArray=[],a.pointerToCurrentSimulationState=0,a.originalMachinePrintingArray=[],a.reducedMachineStorageTapePrintingArray=[],a.greenStoragePrintingArray=[],a.greenCopyPrintingArray=[],a.historyStack=new CircularStack,a.visualizationMode=a.visualizationStateEnum.NO_VISUALIZATION,a.separatorArrayPositive=[0],a.separatorArrayNegative=[0],a.currentDelta=void 0,a.$watch("kNumber.value",function(){for(var b=0;b<a.kNumber.value;b++)a.originalMachinePrintingArray.push({value:40+60*b});a.storageTapeOffset.value=80+60*a.kNumber.value;for(var b=0;b<a.kNumber.value;b++)a.reducedMachineStorageTapePrintingArray.push({value:a.storageTapeOffset.value+80*b}),a.reducedMachineStorageTapePrintingArray.push({value:a.storageTapeOffset.value+40+80*b});a.reducedMachineCopyTapeOffset.value=a.storageTapeOffset.value+40+80*a.kNumber.value,a.neededHeightOfSvg.value=a.reducedMachineCopyTapeOffset.value+100;for(var b=0;b<a.kNumber.value;b++)a.originalMachineViews.push(new MachineView);a.reducedMachineStorageTapeViews.reInitialise(-8,9,0)},!0),a.restartSimulation=function(){b.location.reload()},a.checkAndStartStep=function(){for(var b=0;b<a.kNumber.value;b++)a.originalMachineViews[b].reInitialiseOriginal();a.simulationMode=a.stateEnum.IN_PROGRESS,a.visualizationMode=a.visualizationStateEnum.NO_VISUALIZATION;for(var c=[],d=[],b=0;b<a.kNumber.value;b++)c.push(a.simulatingArray.value[b].overwriteValue),d.push(a.simulatingArray.value[b].movement);a.reducedMachineStorageTapeViews.reInitialise(-8,9,0),a.backupTapes(),a.redrawOriginalMachine(c,d),a.mainSimulatingFunction(c,d)},a.findDeltaAndStartStep=function(){a.currentDelta=void 0,a.simulationMode=a.stateEnum.IN_PROGRESS,a.visualizationMode=a.visualizationStateEnum.NO_VISUALIZATION;for(var c=[],d=0;d<a.kNumber.value;d++)c.push(a.kSourceTapes.value[d].charAt(a.originalMachineViews[d].getCurrentHeadPosition())),a.originalMachineViews[d].reInitialiseOriginal();for(var e,f,g=!1,d=0;d<a.deltaFunction.value.length;d++)if(a.deltaFunction.value[d].getOriginalState()==a.originalMachineState&&a.deltaFunction.value[d].getReading().toString()===c.toString()){e=a.deltaFunction.value[d].getPrinting(),f=a.deltaFunction.value[d].getMoving(),a.originalMachineState=a.deltaFunction.value[d].getNewState(),g=!0,a.currentDelta=a.deltaFunction.value[d];break}if(!g)return b.alert("\u017diadna zhoda s deltafunkciou, stroj sa zasekol"),void(a.simulationMode=a.stateEnum.IDLE);for(var d=0;d<a.kNumber.value;d++)a.simulatingArray.value[d].movement=f[d];a.reducedMachineStorageTapeViews.reInitialise(-8,9,0),a.backupTapes(),a.redrawOriginalMachine(e,f),a.mainSimulatingFunction(e,f)},a.nextStep=function(){if(a.pointerToCurrentSimulationState===a.currentSimulationStateArray.length)return a.currentSimulationStateArray.length=0,a.pointerToCurrentSimulationState=0,a.greenStoragePrintingArray.length=0,a.greenCopyPrintingArray.length=0,void(a.simulationMode=a.stateEnum.IDLE);var b=1,c=a.currentSimulationStateArray[a.pointerToCurrentSimulationState];switch((c.getStepState()==a.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE||c.getStepState()==a.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE)&&(c.getIBlockNumber()>0?Math.pow(2,c.getIBlockNumber())-1>a.separatorArrayPositive[a.separatorArrayPositive.length-1]&&a.separatorArrayPositive.push(Math.pow(2,c.getIBlockNumber())-1):Math.pow(2,-c.getIBlockNumber())-1>a.separatorArrayNegative[a.separatorArrayNegative.length-1]&&a.separatorArrayNegative.push(Math.pow(2,-c.getIBlockNumber())-1)),(c.getStepState()==a.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE||c.getStepState()==a.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE)&&(c.getIBlockNumber()>0?Math.pow(2,c.getIBlockNumber())-1>a.separatorArrayPositive[a.separatorArrayPositive.length-1]&&a.separatorArrayPositive.push(Math.pow(2,c.getIBlockNumber())-1):Math.pow(2,-c.getIBlockNumber())-1>a.separatorArrayNegative[a.separatorArrayNegative.length-1]&&a.separatorArrayNegative.push(Math.pow(2,-c.getIBlockNumber())-1)),c.getStepState()){case a.simulationStateEnum.VISUALIZE_OVERWRITING_HOME_COLUMN:a.greenCopyPrintingArray.length=0,a.greenStoragePrintingArray.length=0,a.greenStoragePrintingArray.push(new PrintingSquare(0,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.OVERWRITING_HOME_COLUMN:a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(a.reducedMachineStorageTapeViews.getCurrentHeadPosition()).lowerLevel=c.getOverwriteSymbol();break;case a.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS:var d=c.getIBlockNumber();if(d>0)for(var e=Math.pow(2,d-1),f=1;e>f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,0,c.getIndexOfOriginalTrack())),a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));else for(var e=-Math.pow(2,-d-1),f=-1;f>e;f--)a.greenStoragePrintingArray.push(new PrintingSquare(f,0,c.getIndexOfOriginalTrack())),a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS:var d=c.getIBlockNumber();if(d>0){for(var g=[0],f=0;d>f;f++)g.push(Math.pow(2,f));for(var h=1;h<g.length;h++){for(var i=g[h-1];i<g[h];i++)0!==i?(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b)):(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b));for(var i=g[h-1];i<g[h];i++)0!==i&&(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b))}}else{for(var g=[0],f=0;-d>f;f++)g.push(-Math.pow(2,f));for(var h=g.length-1;h>0;h--){for(var i=g[h]+1;i<=g[h-1];i++)a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b);for(var i=g[h]+1;i<=g[h-1];i++)0!==i&&(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b))}}break;case a.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE:a.greenStoragePrintingArray.length=0;var d=c.getIBlockNumber();if(d>0)for(var j=Math.pow(2,d),f=1;j>f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));else for(var j=-Math.pow(2,-d),f=j+1;-1>=f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE:a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(0).lowerLevel=" ";var d=c.getIBlockNumber();if(d>0)for(var j=Math.pow(2,d),f=1;j>f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f-1];else for(var j=-Math.pow(2,-d),f=j+1;-1>=f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f-j-1];a.reducedMachineCopyTapeArray.length=0;break;case a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:var d=c.getIBlockNumber();if(d>0)for(var e=Math.pow(2,d-1),f=1;e>f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,0,c.getIndexOfOriginalTrack())),a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));else for(var e=-Math.pow(2,-d-1),f=-1;f>e;f--)a.greenStoragePrintingArray.push(new PrintingSquare(f,0,c.getIndexOfOriginalTrack())),a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:var d=c.getIBlockNumber();if(d>0){for(var g=[0],f=0;d>f;f++)g.push(Math.pow(2,f));for(var h=1;h<g.length;h++){for(var i=g[h-1];i<g[h];i++)0!==i?(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b)):(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b));for(var i=g[h-1];i<g[h];i++)0!==i&&(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b))}}else{for(var g=[0],f=0;-d>f;f++)g.push(-Math.pow(2,f));for(var h=g.length-1;h>0;h--){for(var i=g[h]+1;i<=g[h-1];i++)a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b);for(var i=g[h]+1;i<=g[h-1];i++)0!==i&&(a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(i).upperLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b))}}break;case a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE:a.greenStoragePrintingArray.length=0;var d=c.getIBlockNumber();if(d>0){for(var j=Math.pow(2,d),k=Math.pow(2,d-1),f=1;k>f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));for(var h=k;j>h;h++)a.greenStoragePrintingArray.push(new PrintingSquare(h,0,c.getIndexOfOriginalTrack()))}else{for(var j=-Math.pow(2,-d),k=-Math.pow(2,-d-1),h=j+1;k>=h;h++)a.greenStoragePrintingArray.push(new PrintingSquare(h,0,c.getIndexOfOriginalTrack()));for(var f=k+1;-1>=f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()))}break;case a.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE:a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(0).lowerLevel=" ";var d=c.getIBlockNumber();if(d>0){for(var j=Math.pow(2,d),k=Math.pow(2,d-1),f=1;k>f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f-1];for(var h=k;j>h;h++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).upperLevel=a.reducedMachineCopyTapeArray[h-1]}else{for(var j=-Math.pow(2,-d),k=-Math.pow(2,-d-1),l=0,h=j+1;k>=h;h++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).upperLevel=a.reducedMachineCopyTapeArray[h-j-1],l++;for(var f=k+1;-1>=f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[l],l++}a.reducedMachineCopyTapeArray.length=0;break;case a.simulationStateEnum.VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE:a.greenCopyPrintingArray.length=0,a.greenStoragePrintingArray.length=0;var d=c.getIBlockNumber();if(0>d)for(var m=-Math.pow(2,-d),n=-Math.pow(2,-d-1),h=m+1;n>=h;h++)a.greenStoragePrintingArray.push(new PrintingSquare(h,0,c.getIndexOfOriginalTrack()));else for(var m=Math.pow(2,d),n=Math.pow(2,d-1),h=n;m>h;h++)a.greenStoragePrintingArray.push(new PrintingSquare(h,0,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE:var d=c.getIBlockNumber();if(0>d)for(var m=-Math.pow(2,-d),n=-Math.pow(2,-d-1),h=m+1;n>=h;h++)a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).upperLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).upperLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b);else for(var m=Math.pow(2,d),n=Math.pow(2,d-1),h=n;m>h;h++)a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).upperLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).upperLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b);break;case a.simulationStateEnum.VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE:a.greenStoragePrintingArray.length=0;var d=c.getIBlockNumber();if(0>d)for(var o=-Math.pow(2,-d-1),f=o+1;0>=f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));else for(var o=Math.pow(2,d-1),f=0;o>f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE:var d=c.getIBlockNumber();if(0>d)for(var o=-Math.pow(2,-d-1),f=o+1;0>=f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f-o-1];else for(var o=Math.pow(2,d-1),f=0;o>f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f];a.reducedMachineCopyTapeArray.length=0;break;case a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:a.greenCopyPrintingArray.length=0,a.greenStoragePrintingArray.length=0;var d=c.getIBlockNumber();if(0>d)for(var p=-Math.pow(2,-d),q=-Math.pow(2,-d-1),h=p+1;q>=h;h++)a.greenStoragePrintingArray.push(new PrintingSquare(h,1,c.getIndexOfOriginalTrack()));else for(var p=Math.pow(2,d),q=Math.pow(2,d-1),h=q;p>h;h++)a.greenStoragePrintingArray.push(new PrintingSquare(h,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:var d=c.getIBlockNumber();if(0>d)for(var p=-Math.pow(2,-d),q=-Math.pow(2,-d-1),h=p+1;q>=h;h++)a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b);else for(var p=Math.pow(2,d),q=Math.pow(2,d-1),h=q;p>h;h++)a.reducedMachineCopyTapeArray.push(a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).lowerLevel),a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(h).lowerLevel=" ",a.greenCopyPrintingArray.length<17&&a.greenCopyPrintingArray.push(b);break;case a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE:a.greenStoragePrintingArray.length=0;var d=c.getIBlockNumber();if(0>d)for(var o=-Math.pow(2,-d-1),f=o+1;0>=f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));else for(var o=Math.pow(2,d-1),f=0;o>f;f++)a.greenStoragePrintingArray.push(new PrintingSquare(f,1,c.getIndexOfOriginalTrack()));break;case a.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE:var d=c.getIBlockNumber();if(0>d)for(var o=-Math.pow(2,-d-1),f=o+1;0>=f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f-o-1];else for(var o=Math.pow(2,d-1),f=0;o>f;f++)a.simulationStorageTapeArray.value[c.getIndexOfOriginalTrack()].get(f).lowerLevel=a.reducedMachineCopyTapeArray[f];a.reducedMachineCopyTapeArray.length=0}a.pointerToCurrentSimulationState++},a.mainSimulatingFunction=function(b,c){a.currentSimulationStateArray.length=0;for(var d=0;d<a.kNumber.value;d++)if(a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_OVERWRITING_HOME_COLUMN,d,null,b[d])),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.OVERWRITING_HOME_COLUMN,d,null,b[d])),0!=c[d]){var e;if(-1==c[d]){for(var f=1;f<a.simulationStorageTapeArray.value[d].positiveLength();f++){if(1===a.simulationStorageTapeArray.value[d].get(f).isEmpty()){e=Math.floor(Math.log(f)/Math.LN2)+1,a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-e,null));break}if(2===a.simulationStorageTapeArray.value[d].get(f).isEmpty()){e=Math.floor(Math.log(f)/Math.LN2)+1,a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,d,-e,null));break}}if(void 0===e){for(var g=a.simulationStorageTapeArray.value[d].positiveLength()-1,h=Math.floor(Math.log(g)/Math.LN2)+1,i=Math.pow(2,h+2-1)-1,j=0;j<a.kNumber.value;j++)for(var k=g+1;i>=k;k++)a.simulationStorageTapeArray.value[j].add(k,new StorageNode(" ","\xd7")),a.simulationStorageTapeArray.value[j].add(-k,new StorageNode(" ","\xd7"));a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-h-1,null))}}if(1==c[d]){for(var f=1;f<a.simulationStorageTapeArray.value[d].negativeLength();f++){if(1===a.simulationStorageTapeArray.value[d].get(-f).isEmpty()){e=-(Math.floor(Math.log(f)/Math.LN2)+1),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-e,null));break}if(2===a.simulationStorageTapeArray.value[d].get(-f).isEmpty()){e=-(Math.floor(Math.log(f)/Math.LN2)+1),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,d,e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE,d,-e,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,d,-e,null));break}}if(void 0===e){for(var g=-(a.simulationStorageTapeArray.value[d].negativeLength()-1),h=-(Math.floor(Math.log(-g)/Math.LN2)+1),i=-(Math.pow(2,-h+2-1)-1),j=0;j<a.kNumber.value;j++)for(var k=-g+1;-i>=k;k++)a.simulationStorageTapeArray.value[d].add(-k,new StorageNode(" ","\xd7")),
a.simulationStorageTapeArray.value[d].add(k,new StorageNode(" ","\xd7"));a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,d,h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,d,h-1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,d,-h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-h+1,null)),a.currentSimulationStateArray.push(new StepInformationContainer(a.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,d,-h+1,null))}}}},a.redrawOriginalMachine=function(b,c){for(var d=0;d<a.kNumber.value;d++){var e=a.kSourceTapes.value[d].split("");e[a.originalMachineViews[d].getCurrentHeadPosition()]=b[d],a.kSourceTapes.value[d]=e.join(""),0!==c[d]&&(1!==c[d]?-1!==c[d]||(a.originalMachineViews[d].moveLeft(),a.originalMachineViews[d].getBeginning()<0&&(a.kSourceTapes.value[d]="\xd7"+a.kSourceTapes.value[d],a.originalMachineViews[d].moveRight())):(a.originalMachineViews[d].moveRight(),a.originalMachineViews[d].getEnd()>a.kSourceTapes.value[d].length&&(a.kSourceTapes.value[d]+="\xd7")))}},a.moveStorageTape=function(b){a.reducedMachineStorageTapeViews.moveView(-b)},a.moveOriginalTapes=function(b,c){a.originalMachineViews[b].moveView(-c)},a.backupTapes=function(){var b={};b.originalTapes=a.kSourceTapes.value,b.originalViews=a.originalMachineViews,b.storageTape=a.simulationStorageTapeArray.value,b.storageTapeViews=a.reducedMachineStorageTapeViews,b.originalMachineState=a.originalMachineState,b.separatorArrayPositive=a.separatorArrayPositive,b.separatorArrayNegative=a.separatorArrayNegative,a.historyStack.push(angular.copy(b))},a.previousStep=function(){var b=a.historyStack.pop();null!==b&&(a.kSourceTapes.value=b.originalTapes,a.originalMachineViews=b.originalViews,a.simulationStorageTapeArray.value=b.storageTape,a.reducedMachineStorageTapeViews=b.storageTapeViews,a.originalMachineState=b.originalMachineState,a.separatorArrayNegative=b.separatorArrayNegative,a.separatorArrayPositive=b.separatorArrayPositive)},a.startVisualize=function(b){switch(a.simulationMode=a.stateEnum.IN_PROGRESS,b){case 1:a.visualizationMode=a.visualizationStateEnum.MODE_1_VISUALIZE;break;case 2:a.visualizationMode=a.visualizationStateEnum.MODE_2_VISUALIZE}}}]);