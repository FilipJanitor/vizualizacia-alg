function Delta(e,a,r,t,n){this._originalState=e,this._reading=a,this._newState=r,this._printing=t,this._moving=n,this.getOriginalState=function(){return this._originalState},this.getReading=function(){return this._reading},this.getNewState=function(){return this._newState},this.getPrinting=function(){return this._printing},this.getMoving=function(){return this._moving}}function StorageNode(e,a){this.upperLevel=e,this.lowerLevel=a,this.isEmpty=function(){return" "===this.upperLevel&&" "===this.lowerLevel?2:" "===this.upperLevel||" "===this.lowerLevel?1:0}}function NegativeArray(){this.__positive=[],this.__negative=[],this.add=function(e,a){"number"==typeof e&&Math.round(e)===e?e>=0?this.__positive[e]=a:this.__negative[-e-1]=a:console.error("indexing to array must be done with integer")},this.get=function(e){return"number"==typeof e&&Math.round(e)===e?e>=0?this.__positive[e]:this.__negative[-e-1]:(console.error("indexing to array must be done with integer - returning null"),null)},this.ePush=function(e){this.__positive.push(e)},this.ePop=function(){return this.__positive.pop()},this.bPush=function(e){this.__negative.push(e)},this.bPop=function(e){return this.__negative.pop()},this.positiveLength=function(){return this.__positive.length},this.negativeLength=function(){return this.__negative.length+1},this.getLength=function(){return this.__positive.length+this.__negative.length+1}}function MachineView(){this._beginning=0,this._end=17,this._head=8,this.changeInterval=function(e,a){return e+17!=a?(console.error("beginning in machine view must be end -17"),!1):(this._beginning=e,void(this._end=a))},this.reInitialise=function(e,a,r){return e+17!=a||e+8!=r?(console.error("beginning in machine view must be end -17 and head -8"),!1):(this._beginning=e,this._end=a,void(this._head=r))},this.getCurrentHeadPosition=function(){return this._head},this.getViewHeadPosition=function(){return this._head-(this._beginning+8)},this.moveRight=function(){this._beginning++,this._end++,this._head++},this.moveLeft=function(){this._beginning--,this._end--,this._head--},this.getBeginning=function(){return this._beginning},this.getEnd=function(){return this._end},this.moveView=function(e){this._beginning+=e,this._end+=e}}function StepInformationContainer(e,a,r,t){this._stepState=e,this._indexOfOriginalTrack=a,this._iBlockNumber=r,this._overwriteSymbol=t,this.getStepState=function(){return this._stepState},this.getIndexOfOriginalTrack=function(){return this._indexOfOriginalTrack},this.getIBlockNumber=function(){return this._iBlockNumber},this.getOverwriteSymbol=function(){return this._overwriteSymbol},this.getStepState=function(){return this._stepState}}function PrintingSquare(e,a,r){this._row=a,this._index=e,this._simulatedTrack=r,this.getRow=function(){return this._row},this.getIndex=function(){return this._index},this.getSimulatedTrack=function(){return this._simulatedTrack}}var app=angular.module("App",[]);app.service("simulationService",function(){var e={},a={},r={},t={},n={},i={},o={};this.simulationStorageTapeArray=o,this.kNumber=e,this.kSourceTapes=a,this.deltaFunction=r,this.mode=t,this.isActive=n,this.simulatingArray=i}),app.controller("mainController",["$scope","simulationService","$window","$log",function(e,a,r,t){e.stateEnum={BEGINNING:1,MODE_1_CHOOSE_INPUT:2,MODE_2_CHOOSE_INPUT:3,MODE_2_CHOOSE_DELTA:4,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},e.kNumber={value:void 0},e.kSourceTapes=[],e.currentState=e.stateEnum.BEGINNING,e.deltaFunction=[],e.deltaArrayTemp=[],e.masterFormCommas="",e.simulationStorageTapeArray=[],e.myMinLength=0,e.myMaxLength=0,e.isDeterministic={value:!0,errLog:""},e.deltaTemp={value:""},e.resetDelta=function(){e.deltaTemp.value=angular.copy(e.masterFormCommas)},e.setMode=function(a){for(var r=0;r<e.kNumber.value;r++)e.kSourceTapes.push("");if(1==a)e.currentState=e.stateEnum.MODE_1_CHOOSE_INPUT;else{e.currentState=e.stateEnum.MODE_2_CHOOSE_INPUT;for(var r=0;r<3*e.kNumber.value+1;r++)e.masterFormCommas+=",";e.myMinLength=3*e.kNumber.value+2,e.myMaxLength=4*e.kNumber.value+2}},e.prepareSimulatingArray=function(){for(var a=[],r=0;r<e.kNumber.value;r++)a.push({movement:"0"});return a},e.changeStateToChooseDelta=function(){e.currentState=e.stateEnum.MODE_2_CHOOSE_DELTA,e.resetDelta()},e.startSimulation=function(r){if(e.simulatingArray=e.prepareSimulatingArray(),e.kSourceTapes[0].length<9){for(var t="",n=9-e.kSourceTapes[0].length;n>0;n--)t+="×";e.kSourceTapes[0]=e.kSourceTapes[0]+t}e.kSourceTapes[0]="××××××××"+e.kSourceTapes[0];for(var i=1;i<e.kNumber.value;i++)e.kSourceTapes[i]="×××××××××××××××××"+e.kSourceTapes[i];for(var o=Math.pow(2,Math.floor(Math.log(e.kSourceTapes[0].length-8-1)/Math.LN2)+1)-1,u=Math.max(o,8),i=0;i<e.kNumber.value;i++)if(e.simulationStorageTapeArray.push(new NegativeArray),0===i){for(var l=0;l<e.kSourceTapes[0].length-8;l++)e.simulationStorageTapeArray[0].add(l,new StorageNode(" ",e.kSourceTapes[0].charAt(l+8)));for(var g=e.kSourceTapes[0].length-8;u>=g;g++)e.simulationStorageTapeArray[0].add(g,new StorageNode(" ","×"));for(var s=1;u>=s;s++)e.simulationStorageTapeArray[0].add(-s,new StorageNode(" ","×"))}else for(var l=-u;u>=l;l++)e.simulationStorageTapeArray[i].add(l,new StorageNode(" ","×"));a.kNumber.value=e.kNumber.value,a.kSourceTapes.value=e.kSourceTapes,a.simulatingArray.value=e.simulatingArray,a.simulationStorageTapeArray.value=e.simulationStorageTapeArray,1==r?(e.currentState=e.stateEnum.MODE_1_SIMULATE,a.mode.value=e.stateEnum.MODE_1_SIMULATE):(e.currentState=e.stateEnum.MODE_2_SIMULATE,a.deltaFunction.value=e.deltaFunction,a.mode.value=e.stateEnum.MODE_2_SIMULATE),a.isActive.value=!0},e.addNewDeltaTemp=function(){e.deltaArrayTemp.push({value:angular.copy(e.masterFormCommas),invalid:!1,err:""})},e.removeDeltaTemp=function(a){e.deltaArrayTemp.splice(a,1)},e.validateDeltaStartSimulation=function(){e.deltaFunction.length=0;for(var a,r=!0,t=!0,n=0;n<e.deltaArrayTemp.length;n++)a=e.registerDelta(e.deltaArrayTemp[n]),a!==!0?(r=!1,e.deltaArrayTemp[n].invalid=!0,e.deltaArrayTemp[n].err=a):(e.deltaArrayTemp[n].invalid=!1,e.deltaArrayTemp[n].err="");for(var i="Chyba nedeterminizmu pri riadkoch: ",n=0;n<e.deltaFunction.length;n++)for(var o=n+1;o<e.deltaFunction.length;o++)e.deltaFunction[n].getOriginalState()==e.deltaFunction[o].getOriginalState()&&e.deltaFunction[n].getReading().toString()===e.deltaFunction[o].getReading().toString()&&(r=!1,t=!1,i+=" "+n+" a "+o+";");r?(e.isDeterministic.value=!0,e.isDeterministic.errLog="",e.startSimulation(3)):t||(e.isDeterministic.value=!1,e.isDeterministic.errLog=i)},e.registerDelta=function(a){var r=a.value.split(","),t="",n={value:!1};r.length!=3*e.kNumber.value+2&&(n.value=!0,t+="Zlá dĺžka vstupu. "),1!=r[0].length&&(n.value=!0,t+="Stav musí mať 1 znak. ");for(var i=r[0],o=[],u=1;u<1+e.kNumber.value;u++)1!=r[u].length?(n.value=!0,t+="Hlava môže čítať práve jeden znak. Problém je v čítaní "+(u-1)+" pásky. "):o.push(r[u]);if(1!=r[1+e.kNumber.value].length)n.value=!0,t+="Nový stav môže byť len 1 znak. ";else var l=r[1+e.kNumber.value];for(var g=[],u=e.kNumber.value+2;u<2+2*e.kNumber.value;u++)1!=r[u].length?(n.value=!0,t+="Hlava môže písať práve jeden znak. Problém je v prepisovaní "+(u-e.kNumber.value+2)+" pásky. "):g.push(r[u]);for(var s=[],u=2+2*e.kNumber.value;u<2+3*e.kNumber.value;u++)"0"==r[u]||"-1"==r[u]||"1"==r[u]?s.push(r[u]):(n.value=!0,t+="Pohyb hlavy môže byť označovaný len -1 0 1. Problém je s hlavou "+(u-2+2*e.kNumber.value)+". ");return 1==n.value?t:(n.value=!1,e.deltaFunction.push(new Delta(i,o,l,g,s)),!0)}}]),app.controller("simulationController",["$scope","$window","$log","simulationService",function(e,a,r,t){e.stateEnum={IDLE:1,IN_PROGRESS:2,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},e.simulationStateEnum={OVERWRITING_HOME_COLUMN:1,EMPTY_BLOCK_REARRANGE_SYMBOLS:2,EMPTY_BLOCK_FROM_COPY_TAPE:3,HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:4,HALF_EMPTY_BLOCK_FROM_COPY_TAPE:5,FULL_BLOCK_ON_OPPOSITE_SIDE:6,FULL_BLOCK_FROM_COPY_TAPE:7,HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:8,HALF_FULL_BLOCK_FROM_COPY_TAPE:9},e.CONSTANT_VIEW_ARRAY=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.CONSTANT_X_VIEW_ARRAY=[60,100,140,180,220,260,300,340,380,420,460,500,540,580,620,660,700],e.reducedMachineCopyTapeOffset={value:0},e.neededHeightOfSvg={value:0},e.storageTapeOffset={value:0},e.originalMachineViews=[],e.reducedMachineStorageTapeViews=new MachineView,e.reducedMachineCopyTapeViews=new MachineView,e.kSourceTapes=t.kSourceTapes,e.kNumber=t.kNumber,e.mainMode=t.mode,e.deltaFunction=t.deltaFunction,e.activeSimulation=t.isActive,e.simulatingArray=t.simulatingArray,e.simulationStorageTapeArray=t.simulationStorageTapeArray,e.reducedMachineCopyTape="                 ",e.reducedMachineCopyTapeArray=[],e.originalMachineState="0",e.simulationMode=e.stateEnum.IDLE,e.currentSimulationStateArray=[],e.pointerToCurrentSimulationState=0,e.originalMachinePrintingArray=[],e.reducedMachineStorageTapePrintingArray=[],e.greenStoragePrintingArray=[],e.$watch("kNumber.value",function(){for(var a=0;a<e.kNumber.value;a++)e.originalMachinePrintingArray.push({value:40+60*a});e.storageTapeOffset.value=80+60*e.kNumber.value;for(var a=0;a<e.kNumber.value;a++)e.reducedMachineStorageTapePrintingArray.push({value:e.storageTapeOffset.value+80*a}),e.reducedMachineStorageTapePrintingArray.push({value:e.storageTapeOffset.value+40+80*a});e.reducedMachineCopyTapeOffset.value=e.storageTapeOffset.value+40+80*e.kNumber.value,e.neededHeightOfSvg.value=e.reducedMachineCopyTapeOffset.value+100;for(var a=0;a<e.kNumber.value;a++)e.originalMachineViews.push(new MachineView);e.reducedMachineStorageTapeViews.reInitialise(-8,9,0)},!0),e.restartSimulation=function(){a.location.reload()},e.checkAndStartStep=function(){r.info("STARTING_SIMULATION"),e.simulationMode=e.stateEnum.IN_PROGRESS;for(var a=[],t=[],n=0;n<e.kNumber.value;n++)a.push(e.simulatingArray.value[n].overwriteValue),t.push(e.simulatingArray.value[n].movement);e.redrawOriginalMachine(a,t),e.mainSimulatingFunction(a,t)},e.findDeltaAndStartStep=function(){e.simulationMode=e.stateEnum.IN_PROGRESS;for(var r=[],t=0;t<e.kNumber.value;t++)r.push(e.kSourceTapes.value[t].charAt(e.originalMachineViews[t].getCurrentHeadPosition()));for(var n,i,o=!1,t=0;t<e.deltaFunction.value.length;t++)if(e.deltaFunction.value[t].getOriginalState()==e.originalMachineState&&e.deltaFunction.value[t].getReading().toString()===r.toString()){n=e.deltaFunction.value[t].getPrinting(),i=e.deltaFunction.value[t].getMoving(),e.originalMachineState=e.deltaFunction.value[t].getNewState(),o=!0;break}if(!o)return a.alert("Žiadna zhoda s deltafunkciou, stroj sa zasekol"),void(e.simulationMode=e.stateEnum.IDLE);for(var t=0;t<e.kNumber.value;t++)e.simulatingArray.value[t].movement=i[t];e.redrawOriginalMachine(n,i),e.mainSimulatingFunction(n,i)},e.nextStep=function(){if(e.pointerToCurrentSimulationState===e.currentSimulationStateArray.length)return e.currentSimulationStateArray.length=0,e.pointerToCurrentSimulationState=0,e.greenStoragePrintingArray.length=0,void(e.simulationMode=e.stateEnum.IDLE);e.reducedMachineStorageTapeViews.reInitialise(-8,9,0);var a=e.currentSimulationStateArray[e.pointerToCurrentSimulationState];switch(a.getStepState()){case e.simulationStateEnum.OVERWRITING_HOME_COLUMN:r.info("OVERWRITING_HOME_COLUMN"),e.greenStoragePrintingArray.length=0,e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(e.reducedMachineStorageTapeViews.getCurrentHeadPosition()).lowerLevel=a.getOverwriteSymbol(),e.greenStoragePrintingArray.push(new PrintingSquare(0,1,a.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS:r.info("EMPTY_BLOCK_REARRANGE_SYMBOLS");var t=a.getIBlockNumber();if(t>0){for(var n=[0],i=0;t>i;i++)n.push(Math.pow(2,i));for(var o=1;o<n.length;o++){for(var u=n[o-1];u<n[o];u++)0!==u?(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" "):e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel);for(var u=n[o-1];u<n[o];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ")}for(var i=1;i<n[n.length-1];i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,a.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()))}else{for(var n=[0],i=0;-t>i;i++)n.push(-Math.pow(2,i));for(var o=n.length-1;o>0;o--){for(var u=n[o]+1;u<=n[o-1];u++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ";for(var u=n[o]+1;u<=n[o-1];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" ")}for(var i=-1;i>n[n.length-1];i--)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,a.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()))}break;case e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE:r.info("EMPTY_BLOCK_FROM_COPY_TAPE"),e.greenStoragePrintingArray.length=0,e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(0).lowerLevel=" ";var t=a.getIBlockNumber();if(t>0)for(var l=Math.pow(2,t),i=1;l>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-1],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));else for(var l=-Math.pow(2,-t),i=l+1;-1>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-l-1],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:r.info("HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS");var t=a.getIBlockNumber();if(r.info("i "+t),t>0){for(var n=[0],i=0;t>i;i++)n.push(Math.pow(2,i));r.info("pole koncov blokov: "+n);for(var o=1;o<n.length;o++){for(var u=n[o-1];u<n[o];u++)0!==u?(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" "):e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel);for(var u=n[o-1];u<n[o];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ")}for(var i=1;i<n[n.length-1];i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,a.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()))}else{for(var n=[0],i=0;-t>i;i++)n.push(-Math.pow(2,i));for(var o=n.length-1;o>0;o--){for(var u=n[o]+1;u<=n[o-1];u++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ";for(var u=n[o]+1;u<=n[o-1];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" ")}for(var i=-1;i>n[n.length-1];i--)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,a.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()))}break;case e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE:r.info("HALF_EMPTY_BLOCK_FROM_COPY_TAPE"),e.greenStoragePrintingArray.length=0,e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(0).lowerLevel=" ";var t=a.getIBlockNumber();if(t>0){for(var l=Math.pow(2,t),g=Math.pow(2,t-1),i=1;g>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-1],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));for(var o=g;l>o;o++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=e.reducedMachineCopyTapeArray[o-1],e.greenStoragePrintingArray.push(new PrintingSquare(o,0,a.getIndexOfOriginalTrack()))}else{for(var l=-Math.pow(2,-t),g=-Math.pow(2,-t-1),s=0,o=l+1;g>=o;o++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=e.reducedMachineCopyTapeArray[o-l-1],e.greenStoragePrintingArray.push(new PrintingSquare(o,0,a.getIndexOfOriginalTrack())),s++;for(var i=g+1;-1>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[s],s++,e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()))}e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE:r.info("FULL_BLOCK_ON_OPPOSITE_SIDE"),e.greenStoragePrintingArray.length=0;var t=a.getIBlockNumber();if(0>t)for(var S=-Math.pow(2,-t),p=-Math.pow(2,-t-1),o=S+1;p>=o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=" ",e.greenStoragePrintingArray.push(new PrintingSquare(o,0,a.getIndexOfOriginalTrack()));else for(var S=Math.pow(2,t),p=Math.pow(2,t-1),o=p;S>o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=" ",e.greenStoragePrintingArray.push(new PrintingSquare(o,0,a.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE:r.info("FULL_BLOCK_FROM_COPY_TAPE"),e.greenStoragePrintingArray.length=0;var t=a.getIBlockNumber();if(0>t)for(var h=-Math.pow(2,-t-1),i=h+1;0>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-h-1],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));else for(var h=Math.pow(2,t-1),i=0;h>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:r.info("HALF_FULL_BLOCK_ON_OPPOSITE_SIDE"),e.greenStoragePrintingArray.length=0;var t=a.getIBlockNumber();if(0>t)for(var m=-Math.pow(2,-t),c=-Math.pow(2,-t-1),o=m+1;c>=o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenStoragePrintingArray.push(new PrintingSquare(o,1,a.getIndexOfOriginalTrack()));else for(var m=Math.pow(2,t),c=Math.pow(2,t-1),o=c;m>o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenStoragePrintingArray.push(new PrintingSquare(o,1,a.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE:r.info("HALF_FULL_BLOCK_FROM_COPY_TAPE"),e.greenStoragePrintingArray.length=0;var t=a.getIBlockNumber();if(0>t)for(var h=-Math.pow(2,-t-1),i=h+1;0>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-h-1],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));else for(var h=Math.pow(2,t-1),i=0;h>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i],e.greenStoragePrintingArray.push(new PrintingSquare(i,1,a.getIndexOfOriginalTrack()));e.reducedMachineCopyTapeArray.length=0;break;default:r.error("Wrong type of simulation step")}e.pointerToCurrentSimulationState++},e.mainSimulatingFunction=function(a,r){e.currentSimulationStateArray.length=0;for(var t=0;t<e.kNumber.value;t++)if(e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.OVERWRITING_HOME_COLUMN,t,null,a[t])),0!=r[t]){var n;if(1==r[t]){for(var i=1;i<e.simulationStorageTapeArray.value[t].positiveLength();i++){if(1===e.simulationStorageTapeArray.value[t].get(i).isEmpty()){n=Math.floor(Math.log(i)/Math.LN2)+1,e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,t,-n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,t,-n,null));break}if(2===e.simulationStorageTapeArray.value[t].get(i).isEmpty()){n=Math.floor(Math.log(i)/Math.LN2)+1,e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,t,-n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,t,-n,null));break}}if(void 0===n){for(var o=e.simulationStorageTapeArray.value[t].positiveLength()-1,u=Math.floor(Math.log(o)/Math.LN2)+1,l=Math.pow(2,u+2-1)-1,g=0;g<e.kNumber.value;g++)for(var s=o+1;l>=s;s++)e.simulationStorageTapeArray.value[g].add(s,new StorageNode(" ","×")),e.simulationStorageTapeArray.value[g].add(-s,new StorageNode(" ","×"));e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,t,u+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,t,u+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,t,-u-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,t,-u-1,null))}}if(-1==r[t]){for(var i=1;i<e.simulationStorageTapeArray.value[t].negativeLength();i++){if(1===e.simulationStorageTapeArray.value[t].get(-i).isEmpty()){n=-(Math.floor(Math.log(i)/Math.LN2)+1),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,t,-n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,t,-n,null));break}if(2===e.simulationStorageTapeArray.value[t].get(-i).isEmpty()){n=-(Math.floor(Math.log(i)/Math.LN2)+1),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,t,n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,t,-n,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,t,-n,null));break}}if(void 0===n){for(var o=-(e.simulationStorageTapeArray.value[t].negativeLength()-1),u=-(Math.floor(Math.log(-o)/Math.LN2)+1),l=-(Math.pow(2,-u+2-1)-1),g=0;g<e.kNumber.value;g++)for(var s=-o+1;-l>=s;s++)e.simulationStorageTapeArray.value[t].add(-s,new StorageNode(" ","×")),e.simulationStorageTapeArray.value[t].add(s,new StorageNode(" ","×"));e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,t,u-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,t,u-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,t,-u+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,t,-u+1,null))}}}},e.redrawOriginalMachine=function(a,r){for(var t=0;t<e.kNumber.value;t++){var n=e.kSourceTapes.value[t].split("");n[e.originalMachineViews[t].getCurrentHeadPosition()]=a[t],e.kSourceTapes.value[t]=n.join(""),0!=r[t]&&(-1!=r[t]?1!=r[t]||(e.originalMachineViews[t].moveLeft(),e.originalMachineViews[t].getBeginning()<0&&(e.kSourceTapes.value[t]="×"+e.kSourceTapes.value[t],e.originalMachineViews[t].moveRight())):(e.originalMachineViews[t].moveRight(),e.originalMachineViews[t].getEnd()>e.kSourceTapes.value[t].length&&(e.kSourceTapes.value[t]+="×")))}},e.moveStorageTape=function(a){e.reducedMachineStorageTapeViews.moveView(-a)}}]);
