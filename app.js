function Delta(e,a,t,r,n){this._originalState=e,this._reading=a,this._newState=t,this._printing=r,this._moving=n,this.getOriginalState=function(){return this._originalState},this.getReading=function(){return this._reading},this.getNewState=function(){return this._newState},this.getPrinting=function(){return this._printing},this.getMoving=function(){return this._moving}}function StorageNode(e,a){this.upperLevel=e,this.lowerLevel=a,this.isEmpty=function(){return" "===this.upperLevel&&" "===this.lowerLevel?2:" "===this.upperLevel||" "===this.lowerLevel?1:0}}function NegativeArray(){this.__positive=[],this.__negative=[],this.add=function(e,a){"number"==typeof e&&Math.round(e)===e?e>=0?this.__positive[e]=a:this.__negative[-e-1]=a:console.error("indexing to array must be done with integer")},this.get=function(e){return"number"==typeof e&&Math.round(e)===e?e>=0?this.__positive[e]:this.__negative[-e-1]:(console.error("indexing to array must be done with integer - returning null"),null)},this.positiveLength=function(){return this.__positive.length},this.negativeLength=function(){return this.__negative.length+1},this.getLength=function(){return this.__positive.length+this.__negative.length+1}}function MachineView(){this._beginning=0,this._end=17,this._head=8,this._originalViewBeginning=0,this._originalViewEnd=17,this.changeInterval=function(e,a){return e+17!=a?!1:(this._beginning=e,void(this._end=a))},this.reInitialise=function(e,a,t){return e+17!=a||e+8!=t?!1:(this._beginning=e,this._end=a,void(this._head=t))},this.getCurrentHeadPosition=function(){return this._head},this.getViewHeadPosition=function(){return this._head-(this._beginning+8)},this.moveRight=function(){this._beginning++,this._end++,this._head++},this.moveLeft=function(){this._beginning--,this._end--,this._head--},this.getBeginning=function(){return this._beginning},this.getEnd=function(){return this._end},this.moveView=function(e){this._beginning+=e,this._end+=e},this.reInitialiseOriginal=function(){this._beginning=this._head-8,this._end=this._beginning+17}}function StepInformationContainer(e,a,t,r){this._stepState=e,this._indexOfOriginalTrack=a,this._iBlockNumber=t,this._overwriteSymbol=r,this.getStepState=function(){return this._stepState},this.getIndexOfOriginalTrack=function(){return this._indexOfOriginalTrack},this.getIBlockNumber=function(){return this._iBlockNumber},this.getOverwriteSymbol=function(){return this._overwriteSymbol},this.getStepState=function(){return this._stepState}}function PrintingSquare(e,a,t){this._row=a,this._index=e,this._simulatedTrack=t,this.getRow=function(){return this._row},this.getIndex=function(){return this._index},this.getSimulatedTrack=function(){return this._simulatedTrack}}function CircularStack(){var e=[],a=0,t=0,r=100;this.push=function(n){e[t]=n,t=(t+1)%r,t==a&&(a=(a+1)%r)},this.pop=function(){if(a==t)return null;t-=1,0>t&&(t+=r);var n=e[t];return n}}var app=angular.module("App",[]);app.service("simulationService",function(){var e={},a={},t={},r={},n={},i={},o={};this.simulationStorageTapeArray=o,this.kNumber=e,this.kSourceTapes=a,this.deltaFunction=t,this.mode=r,this.isActive=n,this.simulatingArray=i}),app.controller("mainController",["$scope","simulationService","$window","$log",function(e,a,t,r){e.stateEnum={BEGINNING:1,MODE_1_CHOOSE_INPUT:2,MODE_2_CHOOSE_INPUT:3,MODE_2_CHOOSE_DELTA:4,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},e.kNumber={value:void 0},e.kSourceTapes=[],e.currentState=e.stateEnum.BEGINNING,e.deltaFunction=[],e.deltaArrayTemp=[],e.masterFormCommas="",e.simulationStorageTapeArray=[],e.myMinLength=0,e.myMaxLength=0,e.isDeterministic={value:!0,errLog:""},e.deltaTemp={value:""},e.resetDelta=function(){e.deltaTemp.value=angular.copy(e.masterFormCommas)},e.restartSimulation=function(){t.location.reload()},e.setMode=function(a){var t;for(t=0;t<e.kNumber.value;t++)e.kSourceTapes.push("");if(1==a)e.currentState=e.stateEnum.MODE_1_CHOOSE_INPUT;else{for(e.currentState=e.stateEnum.MODE_2_CHOOSE_INPUT,t=0;t<3*e.kNumber.value+1;t++)e.masterFormCommas+=",";e.myMinLength=3*e.kNumber.value+2,e.myMaxLength=4*e.kNumber.value+2}},e.prepareSimulatingArray=function(){for(var a=[],t=0;t<e.kNumber.value;t++)a.push({movement:"0"});return a},e.changeStateToChooseDelta=function(){e.currentState=e.stateEnum.MODE_2_CHOOSE_DELTA,e.resetDelta()},e.startSimulation=function(t){e.simulatingArray=e.prepareSimulatingArray();var r,n,i;if(e.kSourceTapes[0].length<9){i="";for(var o=9-e.kSourceTapes[0].length;o>0;o--)i+="×";e.kSourceTapes[0]=e.kSourceTapes[0]+i}for(e.kSourceTapes[0]="××××××××"+e.kSourceTapes[0],r=1;r<e.kNumber.value;r++)e.kSourceTapes[r]="×××××××××××××××××"+e.kSourceTapes[r];var u=Math.pow(2,Math.floor(Math.log(e.kSourceTapes[0].length-8-1)/Math.LN2)+1)-1,l=Math.max(u,8);for(r=0;r<e.kNumber.value;r++)if(e.simulationStorageTapeArray.push(new NegativeArray),0===r){for(n=0;n<e.kSourceTapes[0].length-8;n++)e.simulationStorageTapeArray[0].add(n,new StorageNode(" ",e.kSourceTapes[0].charAt(n+8)));for(var g=e.kSourceTapes[0].length-8;l>=g;g++)e.simulationStorageTapeArray[0].add(g,new StorageNode(" ","×"));for(var S=1;l>=S;S++)e.simulationStorageTapeArray[0].add(-S,new StorageNode(" ","×"))}else for(n=-l;l>=n;n++)e.simulationStorageTapeArray[r].add(n,new StorageNode(" ","×"));a.kNumber.value=e.kNumber.value,a.kSourceTapes.value=e.kSourceTapes,a.simulatingArray.value=e.simulatingArray,a.simulationStorageTapeArray.value=e.simulationStorageTapeArray,1==t?(e.currentState=e.stateEnum.MODE_1_SIMULATE,a.mode.value=e.stateEnum.MODE_1_SIMULATE):(e.currentState=e.stateEnum.MODE_2_SIMULATE,a.deltaFunction.value=e.deltaFunction,a.mode.value=e.stateEnum.MODE_2_SIMULATE),a.isActive.value=!0},e.addNewDeltaTemp=function(){e.deltaArrayTemp.push({value:angular.copy(e.masterFormCommas),invalid:!1,err:""})},e.removeDeltaTemp=function(a){e.deltaArrayTemp.splice(a,1)},e.validateDeltaStartSimulation=function(){e.deltaFunction.length=0;var a,t,r=!0,n=!0;for(t=0;t<e.deltaArrayTemp.length;t++)a=e.registerDelta(e.deltaArrayTemp[t]),a!==!0?(r=!1,e.deltaArrayTemp[t].invalid=!0,e.deltaArrayTemp[t].err=a):(e.deltaArrayTemp[t].invalid=!1,e.deltaArrayTemp[t].err="");var i="Chyba nedeterminizmu pri riadkoch: ";for(t=0;t<e.deltaFunction.length;t++)for(var o=t+1;o<e.deltaFunction.length;o++)e.deltaFunction[t].getOriginalState()==e.deltaFunction[o].getOriginalState()&&e.deltaFunction[t].getReading().toString()===e.deltaFunction[o].getReading().toString()&&(r=!1,n=!1,i+=" "+(t+1)+" a "+(o+1)+";");r?(e.isDeterministic.value=!0,e.isDeterministic.errLog="",e.startSimulation(3)):n||(e.isDeterministic.value=!1,e.isDeterministic.errLog=i)},e.registerDelta=function(a){var t,r,n=a.value.split(","),i="",o={value:!1};n.length!=3*e.kNumber.value+2&&(o.value=!0,i+="Zlá dĺžka vstupu. "),n[0].length>15&&(o.value=!0,i+="Stav musí mať najviac 15 znakov. ");var u=n[0],l=[];for(t=1;t<1+e.kNumber.value;t++)1!=n[t].length?(o.value=!0,i+="Hlava môže čítať práve jeden znak. Problém je v čítaní "+(t-1+1)+" pásky. "):l.push(n[t]);1!=n[1+e.kNumber.value].length?(o.value=!0,i+="Nový stav môže mať najviac 15 znakov. "):r=n[1+e.kNumber.value];var g=[];for(t=e.kNumber.value+2;t<2+2*e.kNumber.value;t++)1!=n[t].length?(o.value=!0,i+="Hlava môže písať práve jeden znak. Problém je v prepisovaní "+(t-(e.kNumber.value+2)+1)+" pásky. "):g.push(n[t]);var S=[];for(t=2+2*e.kNumber.value;t<2+3*e.kNumber.value;t++)"0"===n[t]||"-1"===n[t]||"1"===n[t]?S.push(n[t]):(o.value=!0,i+="Pohyb hlavy môže byť označovaný len -1 0 1. Problém je s hlavou "+(t-(2+2*e.kNumber.value)+1)+". ");return o.value===!0?i:(o.value=!1,e.deltaFunction.push(new Delta(u,l,r,g,S)),!0)}}]),app.controller("simulationController",["$scope","$window","$log","simulationService",function(e,a,t,r){e.stateEnum={IDLE:1,IN_PROGRESS:2,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},e.simulationStateEnum={OVERWRITING_HOME_COLUMN:1,EMPTY_BLOCK_REARRANGE_SYMBOLS:2,EMPTY_BLOCK_FROM_COPY_TAPE:3,HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:4,HALF_EMPTY_BLOCK_FROM_COPY_TAPE:5,FULL_BLOCK_ON_OPPOSITE_SIDE:6,FULL_BLOCK_FROM_COPY_TAPE:7,HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:8,HALF_FULL_BLOCK_FROM_COPY_TAPE:9,VISUALIZE_OVERWRITING_HOME_COLUMN:11,VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS:12,VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE:13,VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:14,VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE:15,VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE:16,VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE:17,VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:18,VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE:19},e.visualizationStateEnum={NO_VISUALIZATION:0,MODE_1_VISUALIZE:1,MODE_2_VISUALIZE:2},e.CONSTANT_VIEW_ARRAY=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.CONSTANT_X_VIEW_ARRAY=[60,100,140,180,220,260,300,340,380,420,460,500,540,580,620,660,700],e.reducedMachineCopyTapeOffset={value:0},e.neededHeightOfSvg={value:0},e.storageTapeOffset={value:0},e.originalMachineViews=[],e.reducedMachineStorageTapeViews=new MachineView,e.reducedMachineCopyTapeViews=new MachineView,e.kSourceTapes=r.kSourceTapes,e.kNumber=r.kNumber,e.mainMode=r.mode,e.deltaFunction=r.deltaFunction,e.activeSimulation=r.isActive,e.simulatingArray=r.simulatingArray,e.simulationStorageTapeArray=r.simulationStorageTapeArray,e.reducedMachineCopyTape="                 ",e.reducedMachineCopyTapeArray=[],e.originalMachineState="0",e.simulationMode=e.stateEnum.IDLE,e.currentSimulationStateArray=[],e.pointerToCurrentSimulationState=0,e.originalMachinePrintingArray=[],e.reducedMachineStorageTapePrintingArray=[],e.greenStoragePrintingArray=[],e.greenCopyPrintingArray=[],e.historyStack=new CircularStack,e.visualizationMode=e.visualizationStateEnum.NO_VISUALIZATION,e.separatorArrayPositive=[0],e.separatorArrayNegative=[0],e.currentDelta=void 0,e.$watch("kNumber.value",function(){var a;for(a=0;a<e.kNumber.value;a++)e.originalMachinePrintingArray.push({value:40+60*a});for(e.storageTapeOffset.value=80+60*e.kNumber.value,a=0;a<e.kNumber.value;a++)e.reducedMachineStorageTapePrintingArray.push({value:e.storageTapeOffset.value+80*a}),e.reducedMachineStorageTapePrintingArray.push({value:e.storageTapeOffset.value+40+80*a});for(e.reducedMachineCopyTapeOffset.value=e.storageTapeOffset.value+40+80*e.kNumber.value,e.neededHeightOfSvg.value=e.reducedMachineCopyTapeOffset.value+100,a=0;a<e.kNumber.value;a++)e.originalMachineViews.push(new MachineView);e.reducedMachineStorageTapeViews.reInitialise(-8,9,0)},!0),e.restartSimulation=function(){a.location.reload()},e.checkAndStartStep=function(){var a;for(a=0;a<e.kNumber.value;a++)e.originalMachineViews[a].reInitialiseOriginal();e.simulationMode=e.stateEnum.IN_PROGRESS,e.visualizationMode=e.visualizationStateEnum.NO_VISUALIZATION;var t=[],r=[];for(a=0;a<e.kNumber.value;a++)t.push(e.simulatingArray.value[a].overwriteValue),r.push(e.simulatingArray.value[a].movement);e.reducedMachineStorageTapeViews.reInitialise(-8,9,0),e.backupTapes(),e.redrawOriginalMachine(t,r),e.mainSimulatingFunction(t,r)},e.findDeltaAndStartStep=function(){e.currentDelta=void 0,e.simulationMode=e.stateEnum.IN_PROGRESS,e.visualizationMode=e.visualizationStateEnum.NO_VISUALIZATION;var t,r=[];for(t=0;t<e.kNumber.value;t++)r.push(e.kSourceTapes.value[t].charAt(e.originalMachineViews[t].getCurrentHeadPosition())),e.originalMachineViews[t].reInitialiseOriginal();var n,i,o=!1;for(t=0;t<e.deltaFunction.value.length;t++)if(e.deltaFunction.value[t].getOriginalState()==e.originalMachineState&&e.deltaFunction.value[t].getReading().toString()===r.toString()){n=e.deltaFunction.value[t].getPrinting(),i=e.deltaFunction.value[t].getMoving(),e.originalMachineState=e.deltaFunction.value[t].getNewState(),o=!0,e.currentDelta=e.deltaFunction.value[t];break}if(!o)return a.alert("Žiadna zhoda s deltafunkciou, stroj sa zasekol"),void(e.simulationMode=e.stateEnum.IDLE);for(t=0;t<e.kNumber.value;t++)e.simulatingArray.value[t].movement=i[t];e.reducedMachineStorageTapeViews.reInitialise(-8,9,0),e.backupTapes(),e.redrawOriginalMachine(n,i),e.mainSimulatingFunction(n,i)},e.nextStep=function(){if(e.pointerToCurrentSimulationState===e.currentSimulationStateArray.length)return e.currentSimulationStateArray.length=0,e.pointerToCurrentSimulationState=0,e.greenStoragePrintingArray.length=0,e.greenCopyPrintingArray.length=0,void(e.simulationMode=e.stateEnum.IDLE);var a,t,r,n,i,o,u,l,g,S,s,p,_,m,h=1,A=e.currentSimulationStateArray[e.pointerToCurrentSimulationState];switch((A.getStepState()==e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE||A.getStepState()==e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE)&&(A.getIBlockNumber()>0?Math.pow(2,A.getIBlockNumber())-1>e.separatorArrayPositive[e.separatorArrayPositive.length-1]&&e.separatorArrayPositive.push(Math.pow(2,A.getIBlockNumber())-1):Math.pow(2,-A.getIBlockNumber())-1>e.separatorArrayNegative[e.separatorArrayNegative.length-1]&&e.separatorArrayNegative.push(Math.pow(2,-A.getIBlockNumber())-1)),(A.getStepState()==e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE||A.getStepState()==e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE)&&(A.getIBlockNumber()>0?Math.pow(2,A.getIBlockNumber())-1>e.separatorArrayPositive[e.separatorArrayPositive.length-1]&&e.separatorArrayPositive.push(Math.pow(2,A.getIBlockNumber())-1):Math.pow(2,-A.getIBlockNumber())-1>e.separatorArrayNegative[e.separatorArrayNegative.length-1]&&e.separatorArrayNegative.push(Math.pow(2,-A.getIBlockNumber())-1)),A.getStepState()){case e.simulationStateEnum.VISUALIZE_OVERWRITING_HOME_COLUMN:e.greenCopyPrintingArray.length=0,e.greenStoragePrintingArray.length=0,e.greenStoragePrintingArray.push(new PrintingSquare(0,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.OVERWRITING_HOME_COLUMN:e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(e.reducedMachineStorageTapeViews.getCurrentHeadPosition()).lowerLevel=A.getOverwriteSymbol();break;case e.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS:if(a=A.getIBlockNumber(),a>0)for(t=Math.pow(2,a-1),n=1;t>n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,0,A.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));else for(t=-Math.pow(2,-a-1),n=-1;n>t;n--)e.greenStoragePrintingArray.push(new PrintingSquare(n,0,A.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS:if(a=A.getIBlockNumber(),a>0){for(r=[0],n=0;a>n;n++)r.push(Math.pow(2,n));for(i=1;i<r.length;i++){for(o=r[i-1];o<r[i];o++)0!==o?(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h)):(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h));for(o=r[i-1];o<r[i];o++)0!==o&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h))}}else{for(r=[0],n=0;-a>n;n++)r.push(-Math.pow(2,n));for(i=r.length-1;i>0;i--){for(o=r[i]+1;o<=r[i-1];o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h);for(o=r[i]+1;o<=r[i-1];o++)0!==o&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h))}}break;case e.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE:if(e.greenStoragePrintingArray.length=0,a=A.getIBlockNumber(),a>0)for(l=Math.pow(2,a),n=1;l>n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));else for(l=-Math.pow(2,-a),n=l+1;-1>=n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE:if(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(0).lowerLevel=" ",a=A.getIBlockNumber(),a>0)for(l=Math.pow(2,a),n=1;l>n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n-1];else for(l=-Math.pow(2,-a),n=l+1;-1>=n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n-l-1];e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:if(a=A.getIBlockNumber(),a>0)for(t=Math.pow(2,a-1),n=1;t>n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,0,A.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));else for(t=-Math.pow(2,-a-1),n=-1;n>t;n--)e.greenStoragePrintingArray.push(new PrintingSquare(n,0,A.getIndexOfOriginalTrack())),e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:if(a=A.getIBlockNumber(),a>0){for(r=[0],n=0;a>n;n++)r.push(Math.pow(2,n));for(i=1;i<r.length;i++){for(o=r[i-1];o<r[i];o++)0!==o?(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h)):(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h));for(o=r[i-1];o<r[i];o++)0!==o&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h))}}else{for(r=[0],n=0;-a>n;n++)r.push(-Math.pow(2,n));for(i=r.length-1;i>0;i--){for(o=r[i]+1;o<=r[i-1];o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h);for(o=r[i]+1;o<=r[i-1];o++)0!==o&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(o).upperLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h))}}break;case e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE:if(e.greenStoragePrintingArray.length=0,a=A.getIBlockNumber(),a>0){for(l=Math.pow(2,a),g=Math.pow(2,a-1),n=1;g>n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));for(i=g;l>i;i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,A.getIndexOfOriginalTrack()))}else{for(l=-Math.pow(2,-a),g=-Math.pow(2,-a-1),i=l+1;g>=i;i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,A.getIndexOfOriginalTrack()));for(n=g+1;-1>=n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()))}break;case e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE:if(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(0).lowerLevel=" ",a=A.getIBlockNumber(),a>0){for(l=Math.pow(2,a),g=Math.pow(2,a-1),n=1;g>n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n-1];for(i=g;l>i;i++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).upperLevel=e.reducedMachineCopyTapeArray[i-1]}else{for(l=-Math.pow(2,-a),g=-Math.pow(2,-a-1),u=0,i=l+1;g>=i;i++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).upperLevel=e.reducedMachineCopyTapeArray[i-l-1],u++;for(n=g+1;-1>=n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[u],u++}e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE:if(e.greenCopyPrintingArray.length=0,e.greenStoragePrintingArray.length=0,a=A.getIBlockNumber(),0>a)for(S=-Math.pow(2,-a),s=-Math.pow(2,-a-1),i=S+1;s>=i;i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,A.getIndexOfOriginalTrack()));else for(S=Math.pow(2,a),s=Math.pow(2,a-1),i=s;S>i;i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,0,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE:if(a=A.getIBlockNumber(),0>a)for(S=-Math.pow(2,-a),s=-Math.pow(2,-a-1),i=S+1;s>=i;i++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).upperLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).upperLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h);else for(S=Math.pow(2,a),s=Math.pow(2,a-1),i=s;S>i;i++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).upperLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).upperLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h);break;case e.simulationStateEnum.VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE:if(e.greenStoragePrintingArray.length=0,a=A.getIBlockNumber(),0>a)for(p=-Math.pow(2,-a-1),n=p+1;0>=n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));else for(p=Math.pow(2,a-1),n=0;p>n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE:if(a=A.getIBlockNumber(),0>a)for(p=-Math.pow(2,-a-1),n=p+1;0>=n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n-p-1];else for(p=Math.pow(2,a-1),n=0;p>n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n];e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:if(e.greenCopyPrintingArray.length=0,e.greenStoragePrintingArray.length=0,a=A.getIBlockNumber(),0>a)for(_=-Math.pow(2,-a),m=-Math.pow(2,-a-1),i=_+1;m>=i;i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,1,A.getIndexOfOriginalTrack()));else for(_=Math.pow(2,a),m=Math.pow(2,a-1),i=m;_>i;i++)e.greenStoragePrintingArray.push(new PrintingSquare(i,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:if(a=A.getIBlockNumber(),0>a)for(_=-Math.pow(2,-a),m=-Math.pow(2,-a-1),i=_+1;m>=i;i++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h);else for(_=Math.pow(2,a),m=Math.pow(2,a-1),i=m;_>i;i++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).lowerLevel),e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(i).lowerLevel=" ",e.greenCopyPrintingArray.length<17&&e.greenCopyPrintingArray.push(h);break;case e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE:if(e.greenStoragePrintingArray.length=0,a=A.getIBlockNumber(),0>a)for(p=-Math.pow(2,-a-1),n=p+1;0>=n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));else for(p=Math.pow(2,a-1),n=0;p>n;n++)e.greenStoragePrintingArray.push(new PrintingSquare(n,1,A.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE:if(a=A.getIBlockNumber(),0>a)for(p=-Math.pow(2,-a-1),n=p+1;0>=n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n-p-1];else for(p=Math.pow(2,a-1),n=0;p>n;n++)e.simulationStorageTapeArray.value[A.getIndexOfOriginalTrack()].get(n).lowerLevel=e.reducedMachineCopyTapeArray[n];e.reducedMachineCopyTapeArray.length=0}e.pointerToCurrentSimulationState++},e.mainSimulatingFunction=function(a,t){e.currentSimulationStateArray.length=0;var r,n,i,o,u,l,g;for(o=0;o<e.kNumber.value;o++)if(e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_OVERWRITING_HOME_COLUMN,o,null,a[o])),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.OVERWRITING_HOME_COLUMN,o,null,a[o])),"0"!=t[o]){var S;if("-1"==t[o]){for(r=1;r<e.simulationStorageTapeArray.value[o].positiveLength();r++){if(1===e.simulationStorageTapeArray.value[o].get(r).isEmpty()){S=Math.floor(Math.log(r)/Math.LN2)+1,e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-S,null));break}if(2===e.simulationStorageTapeArray.value[o].get(r).isEmpty()){S=Math.floor(Math.log(r)/Math.LN2)+1,e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,o,-S,null));break}}if(void 0===S){for(u=e.simulationStorageTapeArray.value[o].positiveLength()-1,l=Math.floor(Math.log(u)/Math.LN2)+1,g=Math.pow(2,l+2-1)-1,n=0;n<e.kNumber.value;n++)for(i=u+1;g>=i;i++)e.simulationStorageTapeArray.value[n].add(i,new StorageNode(" ","×")),e.simulationStorageTapeArray.value[n].add(-i,new StorageNode(" ","×"));e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-l-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-l-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-l-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-l-1,null))}}if("1"==t[o]){for(r=1;r<e.simulationStorageTapeArray.value[o].negativeLength();r++){if(1===e.simulationStorageTapeArray.value[o].get(-r).isEmpty()){S=-(Math.floor(Math.log(r)/Math.LN2)+1),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-S,null));break}if(2===e.simulationStorageTapeArray.value[o].get(-r).isEmpty()){S=-(Math.floor(Math.log(r)/Math.LN2)+1),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,o,S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_FULL_BLOCK_FROM_COPY_TAPE,o,-S,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,o,-S,null));break}}if(void 0===S){for(u=-(e.simulationStorageTapeArray.value[o].negativeLength()-1),l=-(Math.floor(Math.log(-u)/Math.LN2)+1),g=-(Math.pow(2,-l+2-1)-1),n=0;n<e.kNumber.value;n++)for(i=-u+1;-g>=i;i++)e.simulationStorageTapeArray.value[o].add(-i,new StorageNode(" ","×")),e.simulationStorageTapeArray.value[o].add(i,new StorageNode(" ","×"));e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,l-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,o,l-1,null)),
e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,l-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,o,l-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,o,-l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.VISUALIZE_HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-l+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,o,-l+1,null))}}}},e.redrawOriginalMachine=function(a,t){for(var r=0;r<e.kNumber.value;r++){var n=e.kSourceTapes.value[r].split("");n[e.originalMachineViews[r].getCurrentHeadPosition()]=a[r],e.kSourceTapes.value[r]=n.join(""),"0"!=t[r]&&("1"!=t[r]?"-1"!=t[r]||(e.originalMachineViews[r].moveLeft(),e.originalMachineViews[r].getBeginning()<0&&(e.kSourceTapes.value[r]="×"+e.kSourceTapes.value[r],e.originalMachineViews[r].moveRight())):(e.originalMachineViews[r].moveRight(),e.originalMachineViews[r].getEnd()>e.kSourceTapes.value[r].length&&(e.kSourceTapes.value[r]+="×")))}},e.moveStorageTape=function(a){e.reducedMachineStorageTapeViews.moveView(-a)},e.moveOriginalTapes=function(a,t){e.originalMachineViews[a].moveView(-t)},e.backupTapes=function(){var a={};a.originalTapes=e.kSourceTapes.value,a.originalViews=e.originalMachineViews,a.storageTape=e.simulationStorageTapeArray.value,a.storageTapeViews=e.reducedMachineStorageTapeViews,a.originalMachineState=e.originalMachineState,a.separatorArrayPositive=e.separatorArrayPositive,a.separatorArrayNegative=e.separatorArrayNegative,e.historyStack.push(angular.copy(a))},e.previousStep=function(){var a=e.historyStack.pop();null!==a&&(e.kSourceTapes.value=a.originalTapes,e.originalMachineViews=a.originalViews,e.simulationStorageTapeArray.value=a.storageTape,e.reducedMachineStorageTapeViews=a.storageTapeViews,e.originalMachineState=a.originalMachineState,e.separatorArrayNegative=a.separatorArrayNegative,e.separatorArrayPositive=a.separatorArrayPositive)},e.startVisualize=function(a){switch(e.simulationMode=e.stateEnum.IN_PROGRESS,a){case 1:e.visualizationMode=e.visualizationStateEnum.MODE_1_VISUALIZE;break;case 2:e.visualizationMode=e.visualizationStateEnum.MODE_2_VISUALIZE}}}]);