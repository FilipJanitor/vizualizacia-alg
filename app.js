function Delta(t,i,n,e,s){this._originalState=t,this._reading=i,this._newState=n,this._printing=e,this._moving=s,this.getOriginalState=function(){return this._originalState},this.getReading=function(){return this._reading},this.getNewState=function(){return this._newState},this.getPrinting=function(){return this._printing},this.getMoving=function(){return this._moving}}function StorageNode(t,i){this.upperLevel=t,this.lowerLevel=i,this.isEmpty=function(){return" "===this.upperLevel&&" "===this.lowerLevel?2:" "===this.upperLevel||" "===this.lowerLevel?1:0}}function NegativeArray(){this.__positive=[],this.__negative=[],this.add=function(t,i){"number"==typeof t&&Math.round(t)===t?t>=0?this.__positive[t]=i:this.__negative[-t-1]=i:console.log("indexing to array must be done with integer")},this.get=function(t){return"number"==typeof t&&Math.round(t)===t?t>=0?this.__positive[t]:this.__negative[-t-1]:(console.log("indexing to array must be done with integer - returning null"),null)},this.ePush=function(t){this.__positive.push(t)},this.ePop=function(){return this.__positive.pop()},this.bPush=function(t){this.__negative.push(t)},this.bPop=function(t){return this.__negative.pop()},this.positiveLength=function(){return this.__positive.length},this.negativeLength=function(){return this.__negative.length+1},this.getLength=function(){return this.__positive.length+this.__negative.length+1}}function MachineView(){this._beginning=0,this._end=17,this.changeInterval=function(t,i){this._beginning=t,this._end=i},this.getCurrentHeadPosition=function(){return this._beginning+8},this.moveRight=function(){this._beginning++,this._end++},this.moveLeft=function(){this._beginning--,this._end--},this.getBeginning=function(){return this._beginning},this.getEnd=function(){return this._end}}function StepInformationContainer(t,i,n,e){this._stepState=t,this._indexOfOriginalTrack=i,this._iBlockNumber=n,this._overwriteSymbol=e,this.getStepState=function(){return this._stepState},this.getIndexOfOriginalTrack=function(){return this._indexOfOriginalTrack},this.getIBlockNumber=function(){return this._iBlockNumber},this.getOverwriteSymbol=function(){return this._overwriteSymbol},this.getStepState=function(){return this._stepState}}function printingSquare(t,i){this.x=t,this.y=i}var app=angular.module("App",[]);app.service("simulationService",function(){var i={},t={},s={},e={},a={},r={},h={};this.simulationStorageTapeArray=h,this.kNumber=i,this.kSourceTapes=t,this.deltaFunction=s,this.mode=e,this.isActive=a,this.simulatingArray=r});app.controller("mainController",["$scope","simulationService","$window","$log",function(e,a,r,t){e.stateEnum={BEGINNING:1,MODE_1_CHOOSE_INPUT:2,MODE_2_CHOOSE_INPUT:3,MODE_2_CHOOSE_DELTA:4,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},e.kNumber={value:void 0},e.kSourceTapes=[],e.currentState=e.stateEnum.BEGINNING,e.deltaFunction=[],e.deltaArrayTemp=[],e.masterFormCommas="",e.simulationStorageTapeArray=[],e.myMinLength=0,e.myMaxLength=0,e.isDeterministic={value:!0,errLog:""},e.deltaTemp={value:""},e.resetDelta=function(){e.deltaTemp.value=angular.copy(e.masterFormCommas)},e.setMode=function(a){for(var r=0;r<e.kNumber.value;r++)e.kSourceTapes.push("");if(1==a)e.currentState=e.stateEnum.MODE_1_CHOOSE_INPUT;else{e.currentState=e.stateEnum.MODE_2_CHOOSE_INPUT;for(var r=0;r<3*e.kNumber.value+1;r++)e.masterFormCommas+=",";e.myMinLength=3*e.kNumber.value+2,e.myMaxLength=4*e.kNumber.value+2}},e.prepareSimulatingArray=function(){for(var a=[],r=0;r<e.kNumber.value;r++)a.push({movement:"0"});return a},e.changeStateToChooseDelta=function(){e.currentState=e.stateEnum.MODE_2_CHOOSE_DELTA,e.resetDelta()},e.startSimulation=function(r){if(e.simulatingArray=e.prepareSimulatingArray(),e.kSourceTapes[0].length<9){for(var t="",u=9-e.kSourceTapes[0].length;u>0;u--)t+="×";e.kSourceTapes[0]=e.kSourceTapes[0]+t}e.kSourceTapes[0]="××××××××"+e.kSourceTapes[0];for(var n=1;n<e.kNumber.value;n++)e.kSourceTapes[n]="×××××××××××××××××"+e.kSourceTapes[n];for(var l=Math.pow(2,Math.floor(Math.log(e.kSourceTapes[0].length-8-1)/Math.LN2)+1)-1,o=Math.max(l,8),n=0;n<e.kNumber.value;n++)if(e.simulationStorageTapeArray.push(new NegativeArray),0===n){for(var i=0;i<e.kSourceTapes[0].length-8;i++)e.simulationStorageTapeArray[0].add(i,new StorageNode(" ",e.kSourceTapes[0].charAt(i+8)));for(var m=e.kSourceTapes[0].length-8;o>=m;m++)e.simulationStorageTapeArray[0].add(m,new StorageNode(" ","×"));for(var s=1;o>=s;s++)e.simulationStorageTapeArray[0].add(-s,new StorageNode(" ","×"))}else for(var i=-o;o>=i;i++)e.simulationStorageTapeArray[n].add(i,new StorageNode(" ","×"));a.kNumber.value=e.kNumber.value,a.kSourceTapes.value=e.kSourceTapes,a.simulatingArray.value=e.simulatingArray,a.simulationStorageTapeArray.value=e.simulationStorageTapeArray,1==r?(e.currentState=e.stateEnum.MODE_1_SIMULATE,a.mode.value=e.stateEnum.MODE_1_SIMULATE):(e.currentState=e.stateEnum.MODE_2_SIMULATE,a.deltaFunction.value=e.deltaFunction,a.mode.value=e.stateEnum.MODE_2_SIMULATE),a.isActive.value=!0},e.addNewDeltaTemp=function(){e.deltaArrayTemp.push({value:angular.copy(e.masterFormCommas),invalid:!1,err:""})},e.removeDeltaTemp=function(a){e.deltaArrayTemp.splice(a,1)},e.validateDeltaStartSimulation=function(){e.deltaFunction.length=0;for(var a,r=!0,t=!0,u=0;u<e.deltaArrayTemp.length;u++)a=e.registerDelta(e.deltaArrayTemp[u]),a!==!0?(r=!1,e.deltaArrayTemp[u].invalid=!0,e.deltaArrayTemp[u].err=a):(e.deltaArrayTemp[u].invalid=!1,e.deltaArrayTemp[u].err="");for(var n="Chyba nedeterminizmu pri riadkoch: ",u=0;u<e.deltaFunction.length;u++)for(var l=u+1;l<e.deltaFunction.length;l++)e.deltaFunction[u].originalState==e.deltaFunction[l].originalState&&e.deltaFunction[u].reading.toString()===e.deltaFunction[l].reading.toString()&&(r=!1,t=!1,n+=" "+u+" a "+l+";");r?(e.isDeterministic.value=!0,e.isDeterministic.errLog="",e.startSimulation(3)):t||(e.isDeterministic.value=!1,e.isDeterministic.errLog=n)},e.registerDelta=function(a){var r=a.value.split(","),t="",u={value:!1};r.length!=3*e.kNumber.value+2&&(u.value=!0,t+="Zlá dĺžka vstupu. "),1!=r[0].length&&(u.value=!0,t+="Stav musí mať 1 znak. ");for(var n=r[0],l=[],o=1;o<1+e.kNumber.value;o++)1!=r[o].length?(u.value=!0,t+="Hlava môže čítať práve jeden znak. Problém je v čítaní "+(o-1)+" pásky. "):l.push(r[o]);if(1!=r[1+e.kNumber.value].length)u.value=!0,t+="Nový stav môže byť len 1 znak. ";else var i=r[1+e.kNumber.value];for(var m=[],o=e.kNumber.value+2;o<2+2*e.kNumber.value;o++)1!=r[o].length?(u.value=!0,t+="Hlava môže písať práve jeden znak. Problém je v prepisovaní "+(o-e.kNumber.value+2)+" pásky. "):m.push(r[o]);for(var s=[],o=2+2*e.kNumber.value;o<2+3*e.kNumber.value;o++)"0"==r[o]||"-1"==r[o]||"1"==r[o]?s.push(r[o]):(u.value=!0,t+="Pohyb hlavy môže byť označovaný len -1 0 1. Problém je s hlavou "+(o-2+2*e.kNumber.value)+". ");return 1==u.value?t:(u.value=!1,e.deltaFunction.push(new Delta(n,l,i,m,s)),!0)}}]);app.controller("simulationController",["$scope","$window","$log","simulationService",function(e,a,r,t){e.stateEnum={IDLE:1,IN_PROGRESS:2,MODE_1_SIMULATE:5,MODE_2_SIMULATE:6},e.simulationStateEnum={OVERWRITING_HOME_COLUMN:1,EMPTY_BLOCK_REARRANGE_SYMBOLS:2,EMPTY_BLOCK_FROM_COPY_TAPE:3,HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:4,HALF_EMPTY_BLOCK_FROM_COPY_TAPE:5,FULL_BLOCK_ON_OPPOSITE_SIDE:6,FULL_BLOCK_FROM_COPY_TAPE:7,HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:8,HALF_FULL_BLOCK_FROM_COPY_TAPE:9},e.CONSTANT_VIEW_ARRAY=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],e.CONSTANT_X_VIEW_ARRAY=[60,100,140,180,220,260,300,340,420,460,500,540,580,620,660,700],e.reducedMachineCopyTapeOffset={value:0},e.neededHeightOfSvg={value:0},e.storageTapeOffset={value:0},e.originalMachineViews=[],e.reducedMachineStorageTapeViews=new MachineView,e.reducedMachineCopyTapeViews=new MachineView,e.kSourceTapes=t.kSourceTapes,e.kNumber=t.kNumber,e.mainMode=t.mode,e.deltaFunction=t.deltaFunction,e.activeSimulation=t.isActive,e.simulatingArray=t.simulatingArray,e.simulationStorageTapeArray=t.simulationStorageTapeArray,e.reducedMachineCopyTape="                 ",e.reducedMachineCopyTapeArray=[],e.originalMachineState="0",e.simulationMode=e.stateEnum.IDLE,e.currentSimulationStateArray=[],e.pointerToCurrentSimulationState=0,e.originalMachinePrintingArray=[],e.reducedMachineStorageTapePrintingArray=[],e.greenStoragePrintingArray=[],e.$watch("kNumber.value",function(){for(var a=0;a<e.kNumber.value;a++)e.originalMachinePrintingArray.push({value:40+60*a});e.storageTapeOffset.value=80+60*e.kNumber.value;for(var a=0;a<e.kNumber.value;a++)e.reducedMachineStorageTapePrintingArray.push({value:e.storageTapeOffset.value+80*a}),e.reducedMachineStorageTapePrintingArray.push({value:e.storageTapeOffset.value+40+80*a});e.reducedMachineCopyTapeOffset.value=e.storageTapeOffset.value+40+80*e.kNumber.value,e.neededHeightOfSvg.value=e.reducedMachineCopyTapeOffset.value+100;for(var a=0;a<e.kNumber.value;a++)e.originalMachineViews.push(new MachineView);e.reducedMachineStorageTapeViews.changeInterval(-8,9)},!0),e.restartSimulation=function(){a.location.reload()},e.checkAndStartStep=function(){r.info("STARTING_SIMULATION"),e.simulationMode=e.stateEnum.IN_PROGRESS;for(var a=[],t=[],n=0;n<e.kNumber.value;n++)a.push(e.simulatingArray.value[n].overwriteValue),t.push(e.simulatingArray.value[n].movement);e.redrawOriginalMachine(a,t),e.mainSimulatingFunction(a,t)},e.findDeltaAndStartStep=function(){e.simulationMode=e.stateEnum.IN_PROGRESS;for(var r=[],t=0;t<e.kNumber.value;t++)r.push(e.kSourceTapes.value[t].charAt(e.originalMachineViews[t].getCurrentHeadPosition()));for(var n,i,o=!1,t=0;t<e.deltaFunction.value.length;t++)if(e.deltaFunction.value[t].getOriginalState()==e.originalMachineState&&e.deltaFunction.value[t].getReading().toString()===r.toString()){n=e.deltaFunction.value[t].getPrinting(),i=e.deltaFunction.value[t].getMoving(),e.originalMachineState=e.deltaFunction.value[t].getNewState(),o=!0;break}if(!o)return a.alert("Žiadna zhoda s deltafunkciou, stroj sa zasekol"),void(e.simulationMode=e.stateEnum.IDLE);for(var t=0;t<e.kNumber.value;t++)e.simulatingArray.value[t].movement=i[t];e.redrawOriginalMachine(n,i),e.mainSimulatingFunction(n,i)},e.nextStep=function(){if(e.pointerToCurrentSimulationState===e.currentSimulationStateArray.length)return e.currentSimulationStateArray.length=0,e.pointerToCurrentSimulationState=0,void(e.simulationMode=e.stateEnum.IDLE);var a=e.currentSimulationStateArray[e.pointerToCurrentSimulationState];switch(a.getStepState()){case e.simulationStateEnum.OVERWRITING_HOME_COLUMN:r.info("OVERWRITING_HOME_COLUMN"),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(e.reducedMachineStorageTapeViews.getCurrentHeadPosition()).lowerLevel=a.getOverwriteSymbol(),e.greenStoragePrintingArray.push(new printingSquare(380,e.storageTapeOffset.value+40+80*a.getIndexOfOriginalTrack()));break;case e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS:r.info("EMPTY_BLOCK_REARRANGE_SYMBOLS"),e.greenStoragePrintingArray.length=0;var t=a.getIBlockNumber();if(t>0){for(var n=[0],i=0;t>i;i++)n.push(Math.pow(2,i));for(var o=1;o<n.length;o++){for(var u=n[o-1];u<n[o];u++)0!==u?(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" "):e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel);for(var u=n[o-1];u<n[o];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ")}}else{for(var n=[0],i=0;-t>i;i++)n.push(-Math.pow(2,i));for(var o=n.length-1;o>0;o--){for(var u=n[o]+1;u<=n[o-1];u++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ";for(var u=n[o]+1;u<=n[o-1];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" ")}}break;case e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE:r.info("EMPTY_BLOCK_FROM_COPY_TAPE"),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(0).lowerLevel=" ";var t=a.getIBlockNumber();if(t>0)for(var l=Math.pow(2,t),i=1;l>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-1];else for(var l=-Math.pow(2,-t),i=l+1;-1>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-l-1];e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS:r.info("HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS"),e.greenStoragePrintingArray.length=0;var t=a.getIBlockNumber();if(r.info("i "+t),t>0){for(var n=[0],i=0;t>i;i++)n.push(Math.pow(2,i));r.info("pole koncov blokov: "+n);for(var o=1;o<n.length;o++){for(var u=n[o-1];u<n[o];u++)0!==u?(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" "):e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel);for(var u=n[o-1];u<n[o];u++)0!==u&&(e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ")}}else{for(var n=[0],i=0;-t>i;i++)n.push(-Math.pow(2,i));r.info("pole koncov blokov: "+n);for(var o=n.length-1;o>0;o--){for(var u=n[o]+1;u<=n[o-1];u++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel),r.info("citam z spodneho levelu "+e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel+" a nulujem to"),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).lowerLevel=" ";for(var u=n[o]+1;u<=n[o-1];u++)0!==u?(r.info("citam z upperlevelu "+e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(u).upperLevel=" "):r.info("citam vrch homesquaru")}}break;case e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE:r.info("HALF_EMPTY_BLOCK_FROM_COPY_TAPE"),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(0).lowerLevel=" ";var t=a.getIBlockNumber();if(t>0){for(var l=Math.pow(2,t),p=Math.pow(2,t-1),i=1;p>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-1];for(var o=p;l>o;o++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=e.reducedMachineCopyTapeArray[o-1]}else{r.info("potom som tu");var l=-Math.pow(2,-t),p=-Math.pow(2,-t-1);r.info("lastindexofi "+l+"; a lastindexofiminusone"+p);for(var g=0,o=l+1;p>=o;o++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=e.reducedMachineCopyTapeArray[o-l-1],r.info("pisem na "+o+"ty stlpec na vrch a citam z copytapu na indexe "+g),g++;for(var i=p+1;-1>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[g],r.info("pisem na "+i+"ty stlpec na spodok a citam z copytapu na indexe "+g),g++}e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE:r.info("FULL_BLOCK_ON_OPPOSITE_SIDE");var t=a.getIBlockNumber();if(0>t)for(var S=-Math.pow(2,-t),m=-Math.pow(2,-t-1),o=S+1;m>=o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=" ";else for(var S=Math.pow(2,t),m=Math.pow(2,t-1),o=m;S>o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).upperLevel=" ";break;case e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE:r.info("FULL_BLOCK_FROM_COPY_TAPE");var t=a.getIBlockNumber();if(0>t)for(var O=-Math.pow(2,-t-1),i=O+1;0>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-LastIndexOfIMinusOneEmpt];else for(var O=Math.pow(2,t-1),i=0;O>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i];e.reducedMachineCopyTapeArray.length=0;break;case e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE:r.info("HALF_FULL_BLOCK_ON_OPPOSITE_SIDE");var t=a.getIBlockNumber();if(0>t)for(var c=-Math.pow(2,-t),s=-Math.pow(2,-t-1),o=c+1;s>=o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel=" ";else for(var c=Math.pow(2,t),s=Math.pow(2,t-1),o=s;c>o;o++)e.reducedMachineCopyTapeArray.push(e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel),e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(o).lowerLevel=" ";break;case e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE:r.info("HALF_FULL_BLOCK_FROM_COPY_TAPE");var t=a.getIBlockNumber();if(0>t)for(var O=-Math.pow(2,-t-1),i=O+1;0>=i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i-O-1];else for(var O=Math.pow(2,t-1),i=0;O>i;i++)e.simulationStorageTapeArray.value[a.getIndexOfOriginalTrack()].get(i).lowerLevel=e.reducedMachineCopyTapeArray[i];e.reducedMachineCopyTapeArray.length=0}e.pointerToCurrentSimulationState++},e.mainSimulatingFunction=function(a,r){e.currentSimulationStateArray.length=0;for(var t=0;t<e.kNumber.value;t++)if(e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.OVERWRITING_HOME_COLUMN,t,null,a[t])),0!=r[t]){if(1==r[t]){for(var n=1;n<e.simulationStorageTapeArray.value[t].positiveLength();n++){if(1===e.simulationStorageTapeArray.value[t].get(n).isEmpty()){blocknumber=Math.floor(Math.log(n)/Math.LN2)+1,e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,t,-blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,t,-blocknumber,null));break}if(2===e.simulationStorageTapeArray.value[t].get(n).isEmpty()){blocknumber=Math.floor(Math.log(n)/Math.LN2)+1,e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,t,-blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,t,-blocknumber,null));break}}if(void 0===blocknumber){for(var i=e.simulationStorageTapeArray.value[t].positiveLength()-1,o=Math.floor(Math.log(i)/Math.LN2)+1,u=Math.pow(2,poslednyblok+2-1)-1,l=0;l<e.kNumber.value;l++)for(var p=i+1;u>=p;p++)e.simulationStorageTapeArray.value[l].add(p,new StorageNode(" ","×")),e.simulationStorageTapeArray.value[l].add(-p,new StorageNode(" ","×"));e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,t,o+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,t,o+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,t,-o-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_FROM_COPY_TAPE,t,-o-1,null))}}if(-1==r[t]){for(var n=1;n<e.simulationStorageTapeArray.value[t].negativeLength();n++){if(1===e.simulationStorageTapeArray.value[t].get(-n).isEmpty()){blocknumber=-(Math.floor(Math.log(n)/Math.LN2)+1),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_REARRANGE_SYMBOLS,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_EMPTY_BLOCK_FROM_COPY_TAPE,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_ON_OPPOSITE_SIDE,t,-blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.HALF_FULL_BLOCK_FROM_COPY_TAPE,t,-blocknumber,null));break}if(2===e.simulationStorageTapeArray.value[t].get(-n).isEmpty()){blocknumber=-(Math.floor(Math.log(n)/Math.LN2)+1),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,t,blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,t,-blocknumber,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_FROM_COPY_TAPE,t,-blocknumber,null));break}}if(void 0===blocknumber){for(var i=-(e.simulationStorageTapeArray.value[t].negativeLength()-1),o=-(Math.floor(Math.log(i)/Math.LN2)+1),u=-(Math.pow(2,-poslednyblok+2-1)-1),l=0;l<e.kNumber.value;l++)for(var p=-i+1;-u>=p;p++)e.simulationStorageTapeArray.value[t].add(-p,new StorageNode(" ","×")),e.simulationStorageTapeArray.value[t].add(p,new StorageNode(" ","×"));e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_REARRANGE_SYMBOLS,t,o-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.EMPTY_BLOCK_FROM_COPY_TAPE,t,o-1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_OPPOSITE_SIDE,t,-o+1,null)),e.currentSimulationStateArray.push(new StepInformationContainer(e.simulationStateEnum.FULL_BLOCK_ON_FROM_COPY_TAPE,t,-o+1,null))}}}},e.redrawOriginalMachine=function(a,r){for(var t=0;t<e.kNumber.value;t++){var n=e.kSourceTapes.value[t].split("");n[e.originalMachineViews[t].getCurrentHeadPosition()]=a[t],e.kSourceTapes.value[t]=n.join(""),0!=r[t]&&(-1!=r[t]?1!=r[t]||(e.originalMachineViews[t].moveLeft(),e.originalMachineViews[t].getBeginning()<0&&(e.kSourceTapes.value[t]="×"+e.kSourceTapes.value[t],e.originalMachineViews[t].moveRight())):(e.originalMachineViews[t].moveRight(),e.originalMachineViews[t].getEnd()>e.kSourceTapes.value[t].length&&(e.kSourceTapes.value[t]+="×")))}}}]);
